@model IEnumerable<Mutterboard.Models.TaskItem>

<div class="container mt-4">
    <div class="card shadow-lg p-4">
        <h2 class="text-center mb-4">
            @(Model.Any(t => !t.IsCompleted) ? "Deine Aufgaben" : "Alle Aufgaben erledigt 🎉")
        </h2>

        @if (Model.Any(t => !t.IsCompleted))
        {
            <div class="table-responsive">
                <table class="table table-hover text-center align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Titel</th>
                            <th>Beschreibung</th>
                            <th>Von</th>
                            <th>Bis</th>
                            <th>Priorität</th>
                            <th>Status</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderByDescending(t => t.Priority))
                        {
                            if (!item.IsCompleted)
                            {
                                <tr class="@GetPriorityClass(item.Priority)">
                                    <td>@item.Title</td>
                                    <td>@item.Description</td>
                                    <td>@item.StartDate.ToShortDateString()</td>
                                    <td>@item.EndDate.ToShortDateString()</td>
                                    <td><span class="badge @GetPriorityBadge(item.Priority)">@GetPriorityName(item.Priority)</span></td>
                                    <td>
                                        <span class="badge @(item.IsCompleted ? "bg-success" : "bg-warning text-dark")">
                                            @(item.IsCompleted ? "Erledigt" : "Offen")
                                        </span>
                                    </td>
                                    <td>
                                        @if (!item.IsCompleted)
                                        {
                                            <form asp-action="CompleteTask" asp-controller="Task" method="post" class="d-inline">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn btn-sm btn-success">Erledigen</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <span class="text-muted">✔️</span>
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@functions {
    string GetPriorityClass(string priority) => priority switch
    {
        "2" => "table-danger",
        "1" => "table-warning",
        "0" => "table-success",
        _ => "table-light"
    };

    string GetPriorityBadge(string priority) => priority switch
    {
        "2" => "bg-danger",
        "1" => "bg-warning text-dark",
        "0" => "bg-success",
        _ => "bg-secondary"
    };

    string GetPriorityName(string priority) => priority switch
    {
        "2" => "Hoch",
        "1" => "Mittel",
        "0" => "Niedrig",
        _ => "EXTREM"
    };
}
